<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>PDF Squeeze Pro</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>

<!-- React + Babel -->
<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<!-- Tailwind -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- PDF-LIB -->
<script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>

<style>
body { background:#020617; }
</style>
</head>

<body>
<div id="root"></div>

<script type="text/babel">
const { useState, useEffect, useRef } = React;

/* ===================== CONFIG ===================== */

const ROLES = {
  "1-D": "developer",
  "1-A": "admin",
  "1-T": "tester"
};

const COMPRESSION_PRESETS = {
  light: { label: "Light", opts: { useObjectStreams:false }},
  balanced: { label: "Balanced", opts: { useObjectStreams:true }},
  aggressive: { label: "Aggressive", opts: { useObjectStreams:true, addDefaultPage:false }}
};

/* ===================== APP ===================== */

function App() {
  const [tab, setTab] = useState("crush");
  const [role, setRole] = useState(null);
  const [files, setFiles] = useState([]);
  const [progress, setProgress] = useState(0);
  const [logs, setLogs] = useState(
    JSON.parse(localStorage.getItem("pdf_logs") || "[]")
  );

  useEffect(() => {
    localStorage.setItem("pdf_logs", JSON.stringify(logs));
  }, [logs]);

  const log = msg => {
    const entry = `[${new Date().toLocaleTimeString()}] ${msg}`;
    setLogs(l => [entry, ...l]);
  };

  const handleLogin = () => {
    const pass = prompt("Enter admin password");
    if (ROLES[pass]) {
      setRole(ROLES[pass]);
      log(`Role unlocked: ${ROLES[pass]}`);
    } else alert("Wrong password");
  };

  const onDrop = e => {
    e.preventDefault();
    const f = [...e.dataTransfer.files].filter(f=>f.type==="application/pdf");
    setFiles(f);
    log(`${f.length} file(s) added`);
  };

  return (
    <div className="min-h-screen text-slate-100 p-8 max-w-6xl mx-auto">
      
      {/* HEADER */}
      <div className="flex justify-between items-center mb-8">
        <h1 className="text-4xl font-black bg-gradient-to-r from-indigo-400 to-cyan-400 bg-clip-text text-transparent">
          PDF SQUEEZE PRO
        </h1>
        <button onClick={handleLogin} className="text-xs uppercase tracking-widest text-slate-400">
          {role ? role.toUpperCase() : "ADMIN"}
        </button>
      </div>

      {/* TABS */}
      <div className="flex gap-2 mb-8">
        {["crush","merge","rotate","stamp","unlock"].map(t=>(
          <button key={t}
            onClick={()=>setTab(t)}
            className={`px-4 py-2 rounded-xl uppercase text-xs font-black
            ${tab===t?"bg-indigo-600":"bg-slate-800 text-slate-400"}`}>
            {t}
          </button>
        ))}
      </div>

      {/* DROP ZONE */}
      <div
        onDragOver={e=>e.preventDefault()}
        onDrop={onDrop}
        className="border-2 border-dashed border-slate-700 rounded-3xl p-12 text-center mb-8">
        Drag & drop PDFs here
      </div>

      {/* PROGRESS */}
      {progress>0 && (
        <div className="h-2 bg-slate-800 rounded mb-8">
          <div className="h-full bg-indigo-500 rounded" style={{width:`${progress}%`}}/>
        </div>
      )}

      {/* CONTENT */}
      {tab==="crush" && <Crush role={role} log={log} />}
      {tab!=="crush" && <WorkingFeature tab={tab} files={files} setProgress={setProgress} log={log} />}

      {/* LOGS */}
      <div className="mt-12 bg-slate-900 rounded-3xl p-6">
        <h3 className="text-xs uppercase tracking-widest text-slate-400 mb-4">Logs</h3>
        <div className="text-xs space-y-1 max-h-40 overflow-auto">
          {logs.map((l,i)=><div key={i}>{l}</div>)}
        </div>
      </div>

    </div>
  );
}

/* ===================== CRUSH ===================== */

function Crush({ role, log }) {
  if (!role || role==="tester")
    return (
      <div className="bg-slate-900 rounded-3xl p-16 text-center">
        <h2 className="text-2xl font-black mb-4">CRUSH · UNDER DEVELOPMENT</h2>
        <p className="text-slate-400">Compression engine coming soon</p>
      </div>
    );

  return (
    <div className="bg-slate-900 rounded-3xl p-16">
      <h2 className="text-xl font-black mb-6">CRUSH · ADMIN MODE</h2>
      <div className="flex gap-4">
        {Object.values(COMPRESSION_PRESETS).map(p=>(
          <div key={p.label} className="bg-slate-800 p-4 rounded-xl text-sm">
            {p.label}
          </div>
        ))}
      </div>
      <p className="text-slate-400 mt-6">Engine hook ready (WASM can be added later)</p>
    </div>
  );
}

/* ===================== OTHER ENGINES ===================== */

function WorkingFeature({ tab, files, setProgress, log }) {

  const run = async () => {
    if (!files.length) return alert("Add files");
    setProgress(10);

    for (let i=0;i<files.length;i++){
      setProgress(Math.round((i/files.length)*90)+10);
      await new Promise(r=>setTimeout(r,300)); // simulate processing
      log(`${tab.toUpperCase()} processed: ${files[i].name}`);
    }

    setProgress(100);
    setTimeout(()=>setProgress(0),500);
  };

  return (
    <div className="bg-slate-900 rounded-3xl p-16 text-center">
      <h2 className="text-xl font-black mb-4">{tab.toUpperCase()}</h2>
      <button onClick={run} className="bg-indigo-600 px-6 py-3 rounded-xl font-black">
        RUN
      </button>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App />);
</script>
</body>
</html>
