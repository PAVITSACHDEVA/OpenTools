<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>PDF Squeeze Pro</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>

<!-- React -->
<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<!-- Tailwind -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- PDF-LIB -->
<script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>

<style>
body { background:#020617; }
</style>
</head>

<body>
  
<div id="root"></div>

<script type="text/babel">
const { useState, useEffect } = React;

/* ================= AUTH ================= */
const ROLES = {
  "1-D": "developer",
  "1-A": "admin",
  "1-T": "tester"
};

/* ================= PRESETS ================= */
const COMPRESSION_PRESETS = {
  light: { label:"Light", opts:{ useObjectStreams:false }},
  balanced: { label:"Balanced", opts:{ useObjectStreams:true }},
  aggressive: { label:"Aggressive", opts:{ useObjectStreams:true, addDefaultPage:false }}
};

/* ================= UTIL ================= */
const saveLog = (msg) => {
  const logs = JSON.parse(localStorage.getItem("logs") || "[]");
  logs.unshift(`[${new Date().toLocaleTimeString()}] ${msg}`);
  localStorage.setItem("logs", JSON.stringify(logs));
};

/* ================= APP ================= */
function App() {
  const [tab, setTab] = useState("crush");
  const [role, setRole] = useState(null);
  const [files, setFiles] = useState([]);
  const [progress, setProgress] = useState({});
  const [results, setResults] = useState([]);
  const [logs, setLogs] = useState(JSON.parse(localStorage.getItem("logs")||"[]"));

  const login = () => {
    const pass = prompt("Enter password");
    if (ROLES[pass]) {
      setRole(ROLES[pass]);
      saveLog(`Logged in as ${ROLES[pass]}`);
      setLogs(JSON.parse(localStorage.getItem("logs")));
    } else alert("Wrong password");
  };

  const onDrop = (e) => {
    e.preventDefault();
    const pdfs = [...e.dataTransfer.files].filter(f=>f.type==="application/pdf");
    setFiles(pdfs);
    saveLog(`${pdfs.length} file(s) added`);
    setLogs(JSON.parse(localStorage.getItem("logs")));
  };

  return (
    <div className="min-h-screen p-8 text-slate-100 max-w-6xl mx-auto">

      {/* HEADER */}
      <div className="flex justify-between mb-8">
        <h1 className="text-4xl font-black bg-gradient-to-r from-indigo-400 to-cyan-400 bg-clip-text text-transparent">
          PDF SQUEEZE PRO
        </h1>
        <button onClick={login} className="text-xs tracking-widest">
          {role ? role.toUpperCase() : "ADMIN"}
        </button>
      </div>

      {/* TABS */}
      <div className="flex gap-2 mb-6">
        {["crush","merge","rotate","stamp","unlock"].map(t=>(
          <button key={t}
            onClick={()=>setTab(t)}
            className={`px-4 py-2 rounded-xl text-xs font-black uppercase
            ${tab===t?"bg-indigo-600":"bg-slate-800 text-slate-400"}`}>
            {t}
          </button>
        ))}
      </div>

      {/* DROP ZONE */}
      <div
        onDragOver={e=>e.preventDefault()}
        onDrop={onDrop}
        className="border-2 border-dashed border-slate-700 rounded-3xl p-10 text-center mb-6">
        Drag & drop PDFs here
      </div>

      {/* CONTENT */}
      {tab==="crush"
        ? <Crush role={role} files={files} setProgress={setProgress} setResults={setResults}/>
        : <Engine tab={tab} files={files} setProgress={setProgress} setResults={setResults}/>
      }

      {/* RESULTS */}
      {results.length>0 && (
        <div className="mt-10 space-y-3">
          <h3 className="text-xs uppercase tracking-widest text-emerald-400">Results</h3>
          {results.map(r=>(
            <a key={r.name} href={r.url} download={r.name}
              className="block bg-emerald-600 text-slate-950 px-6 py-3 rounded-xl font-black text-sm">
              Download {r.name}
            </a>
          ))}
        </div>
      )}

      {/* LOGS */}
      <div className="mt-12 bg-slate-900 rounded-3xl p-6">
        <h3 className="text-xs uppercase tracking-widest mb-3">Logs</h3>
        <div className="text-xs space-y-1 max-h-40 overflow-auto">
          {logs.map((l,i)=><div key={i}>{l}</div>)}
        </div>
      </div>

    </div>
  );
}

/* ================= CRUSH ================= */
function Crush({ role, files, setProgress, setResults }) {

  if (!role || role==="tester") {
    return (
      <div className="bg-slate-900 rounded-3xl p-14 text-center">
        <h2 className="text-2xl font-black mb-2">CRUSH · UNDER DEVELOPMENT</h2>
        <p className="text-slate-400">Compression engine coming soon</p>
      </div>
    );
  }

  const run = async (presetKey) => {
    const out = [];
    for (const f of files) {
      setProgress(p=>({ ...p, [f.name]: 0 }));
      const bytes = await f.arrayBuffer();
      const pdf = await PDFLib.PDFDocument.load(bytes);
      const newBytes = await pdf.save(COMPRESSION_PRESETS[presetKey].opts);
      const blob = new Blob([newBytes], { type:"application/pdf" });
      out.push({ name:`${presetKey}_${f.name}`, url:URL.createObjectURL(blob) });
      saveLog(`CRUSH ${presetKey}: ${f.name}`);
    }
    setResults(out);
  };

  return (
    <div className="bg-slate-900 rounded-3xl p-10">
      <h2 className="text-xl font-black mb-6">CRUSH · ADMIN MODE</h2>
      <div className="flex gap-3">
        {Object.entries(COMPRESSION_PRESETS).map(([k,v])=>(
          <button key={k} onClick={()=>run(k)}
            className="bg-indigo-600 px-5 py-3 rounded-xl text-xs font-black">
            {v.label}
          </button>
        ))}
      </div>
    </div>
  );
}

/* ================= OTHER ENGINES ================= */
function Engine({ tab, files, setProgress, setResults }) {
  const run = async () => {
    const out = [];
    for (const f of files) {
      setProgress(p=>({ ...p, [f.name]: 0 }));
      await new Promise(r=>setTimeout(r,400));
      out.push({ name:`${tab}_${f.name}`, url:URL.createObjectURL(f) });
      saveLog(`${tab.toUpperCase()}: ${f.name}`);
    }
    setResults(out);
  };

  return (
    <div className="bg-slate-900 rounded-3xl p-10 text-center">
      <h2 className="text-xl font-black mb-4">{tab.toUpperCase()}</h2>
      <button onClick={run}
        className="bg-indigo-600 px-6 py-3 rounded-xl font-black">
        RUN
      </button>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App />);
</script>
</body>
</html>
