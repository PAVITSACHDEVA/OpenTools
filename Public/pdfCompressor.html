<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PDF Squeeze Pro</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- React -->
<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<!-- Tailwind -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- PDF-LIB -->
<script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>

<style>
body { background:#020617; }
</style>
</head>

<body>
<div id="root"></div>

<script type="text/babel">
const { useState } = React;

/* ================= LOGS ================= */
const addLog = msg => {
  const logs = JSON.parse(localStorage.getItem("logs") || "[]");
  logs.unshift(`[${new Date().toLocaleTimeString()}] ${msg}`);
  localStorage.setItem("logs", JSON.stringify(logs));
};

/* ================= APP ================= */
function App() {
  const [tab, setTab] = useState("merge");
  const [files, setFiles] = useState([]);
  const [results, setResults] = useState([]);
  const [progress, setProgress] = useState({});
  const [logs] = useState(JSON.parse(localStorage.getItem("logs") || "[]"));

  const onDrop = e => {
    e.preventDefault();
    const pdfs = [...e.dataTransfer.files].filter(f => f.type === "application/pdf");
    setFiles(pdfs);
    addLog(`${pdfs.length} PDF(s) added`);
  };

  return (
    <div className="max-w-6xl mx-auto p-8 text-white">
      <h1 className="text-4xl font-black mb-6 bg-gradient-to-r from-indigo-400 to-cyan-400 bg-clip-text text-transparent">
        PDF SQUEEZE PRO
      </h1>

      {/* TABS */}
      <div className="flex gap-2 mb-6">
        {["merge","rotate","stamp","unlock","crush"].map(t => (
          <button key={t}
            onClick={() => setTab(t)}
            className={`px-4 py-2 rounded-xl uppercase text-xs font-black
              ${tab===t?"bg-indigo-600":"bg-slate-800 text-slate-400"}`}>
            {t}
          </button>
        ))}
      </div>

      {/* DROP ZONE */}
      <div
        onDragOver={e=>e.preventDefault()}
        onDrop={onDrop}
        className="border-2 border-dashed border-slate-700 rounded-3xl p-10 text-center mb-6">
        Drag & Drop PDFs Here
      </div>

      {/* TOOLS */}
      {tab==="merge" && <MergeTool files={files} setResults={setResults} />}
      {tab==="rotate" && <RotateTool files={files} setResults={setResults} setProgress={setProgress} />}
      {tab==="stamp" && <StampTool files={files} setResults={setResults} setProgress={setProgress} />}
      {tab==="unlock" && <UnlockTool files={files} setResults={setResults} setProgress={setProgress} />}
      {tab==="crush" && (
        <div className="bg-slate-900 rounded-3xl p-12 text-center">
          <h2 className="text-2xl font-black">CRUSH</h2>
          <p className="text-slate-400">Under Development</p>
        </div>
      )}

      {/* RESULTS */}
      {results.length > 0 && (
        <div className="mt-10 space-y-3">
          <h3 className="text-xs uppercase tracking-widest text-emerald-400">Downloads</h3>
          {results.map(r => (
            <a key={r.name} href={r.url} download={r.name}
              className="block bg-emerald-600 text-slate-950 px-6 py-3 rounded-xl font-black">
              Download {r.name}
            </a>
          ))}
        </div>
      )}

      {/* LOGS */}
      <div className="mt-12 bg-slate-900 rounded-3xl p-6">
        <h3 className="text-xs uppercase tracking-widest mb-3">Logs</h3>
        <div className="text-xs space-y-1 max-h-40 overflow-auto">
          {logs.map((l,i)=><div key={i}>{l}</div>)}
        </div>
      </div>
    </div>
  );
}

/* ================= MERGE ================= */
function MergeTool({ files, setResults }) {
  const [name, setName] = useState("merged.pdf");

  const run = async () => {
    const { PDFDocument } = PDFLib;
    const merged = await PDFDocument.create();

    for (const f of files) {
      const pdf = await PDFDocument.load(await f.arrayBuffer());
      const pages = await merged.copyPages(pdf, pdf.getPageIndices());
      pages.forEach(p => merged.addPage(p));
    }

    const bytes = await merged.save();
    setResults([{ name, url: URL.createObjectURL(new Blob([bytes],{type:"application/pdf"})) }]);
    addLog("Merged PDFs");
  };

  return (
    <div className="bg-slate-900 rounded-3xl p-10 space-y-4">
      <input value={name} onChange={e=>setName(e.target.value)}
        className="bg-slate-800 p-3 rounded-xl w-full" />
      <button onClick={run} className="bg-indigo-600 px-6 py-3 rounded-xl font-black">MERGE</button>
    </div>
  );
}

/* ================= ROTATE ================= */
function RotateTool({ files, setResults }) {
  const [angle, setAngle] = useState(90);

  const run = async () => {
    const out = [];
    const { PDFDocument, degrees } = PDFLib;

    for (const f of files) {
      const pdf = await PDFDocument.load(await f.arrayBuffer());
      pdf.getPages().forEach(p => p.setRotation(degrees(angle)));
      const bytes = await pdf.save();
      out.push({ name:`rotated_${f.name}`, url:URL.createObjectURL(new Blob([bytes],{type:"application/pdf"})) });
    }
    setResults(out);
    addLog("Rotated PDFs");
  };

  return (
    <div className="bg-slate-900 rounded-3xl p-10 space-y-4">
      <select value={angle} onChange={e=>setAngle(+e.target.value)}
        className="bg-slate-800 p-3 rounded-xl">
        <option value={90}>90°</option>
        <option value={180}>180°</option>
        <option value={270}>270°</option>
      </select>
      <button onClick={run} className="bg-indigo-600 px-6 py-3 rounded-xl font-black">ROTATE</button>
    </div>
  );
}

/* ================= STAMP ================= */
function StampTool({ files, setResults }) {
  const [text, setText] = useState("DRAFT");
  const [size, setSize] = useState(40);
  const [opacity, setOpacity] = useState(0.3);

  const run = async () => {
    const out = [];
    const { PDFDocument, rgb, degrees, StandardFonts } = PDFLib;

    for (const f of files) {
      const pdf = await PDFDocument.load(await f.arrayBuffer());
      const font = await pdf.embedFont(StandardFonts.HelveticaBold);
      pdf.getPages().forEach(p => {
        const { width, height } = p.getSize();
        p.drawText(text,{
          x: width/4, y: height/2,
          size, rotate:degrees(45),
          opacity, color:rgb(0.6,0.6,0.6), font
        });
      });
      const bytes = await pdf.save();
      out.push({ name:`stamped_${f.name}`, url:URL.createObjectURL(new Blob([bytes],{type:"application/pdf"})) });
    }
    setResults(out);
    addLog("Stamped PDFs");
  };

  return (
    <div className="bg-slate-900 rounded-3xl p-10 space-y-4">
      <input value={text} onChange={e=>setText(e.target.value)}
        className="bg-slate-800 p-3 rounded-xl w-full" />
      <button onClick={run} className="bg-indigo-600 px-6 py-3 rounded-xl font-black">STAMP</button>
    </div>
  );
}

/* ================= UNLOCK ================= */
function UnlockTool({ files, setResults }) {
  const run = async () => {
    const out = [];
    const { PDFDocument } = PDFLib;

    for (const f of files) {
      const pdf = await PDFDocument.load(await f.arrayBuffer(),{ignoreEncryption:true});
      const bytes = await pdf.save();
      out.push({ name:`unlocked_${f.name}`, url:URL.createObjectURL(new Blob([bytes],{type:"application/pdf"})) });
    }
    setResults(out);
    addLog("Unlocked PDFs");
  };

  return (
    <div className="bg-slate-900 rounded-3xl p-10">
      <button onClick={run} className="bg-indigo-600 px-6 py-3 rounded-xl font-black">UNLOCK</button>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App />);
</script>
</body>
</html>
